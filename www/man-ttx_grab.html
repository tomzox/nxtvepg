<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/HTMLlat1.ent">
<HTML lang="en">
<HEAD>
<TITLE>tv_grab_ttx manual</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<META name="language" content="en">
<META name="author" content="T. Zoerner">
<META name="copyright" content="T. Zoerner">
<META name="keywords" content="tv_gab_ttx, options, command line options, manual, man page">
<META name="description" content="Online Documentation for the teletext EPG grabber software.">
<META name="robots" content="index, follow">
<META name="revisit-after" content="01 month">
<LINK rel="stylesheet" type="text/css" href="nxtvepg.css">
<LINK rel="shortcut icon" type="image/x-icon" href="nxtvepg.ico">
<LINK rel="top" href="ttx_grab.html" title="teletext EPG grabber homepage">
</HEAD>
<BODY>

<DIV CLASS="navBar">
<P><SMALL>
<IMG ALT="" SRC="nxtv_icon.gif">&nbsp;nxtvepg&nbsp;
<A HREF="index.html">home</A>
</SMALL></P></DIV>

<DIV class="navBlock">
<H2 class="navhead">Language</H2>
<P>
<IMG ALT="" SRC="en.png" WIDTH="16" HEIGHT="10"> English<BR>
<IMG ALT="" SRC="de.png" WIDTH="16" HEIGHT="10"> <SPAN class="navDisabled">Deutsch</SPAN><BR>
<IMG ALT="" SRC="fr.png" WIDTH="16" HEIGHT="10"> <SPAN class="navDisabled">Français</SPAN><BR>
</P>

<H2 class="navhead">Documentation</H2>
<P>
<SPAN CLASS="navPointer">tv_grab_ttx</SPAN><BR>
</P>
<H2 class="navhead">Related Links</H2>
<P>
<A HREF="http://nxtvepg.sourceforge.net/">nxtvepg</A><BR>
<A HREF="http://xmltv.org/">XMLTV</A><BR>
</P>
<H2 class="navhead">Hosted by</H2>
<span class="center"><span class="logo"><a href="http://sourceforge.net"><img
src="http://sourceforge.net/sflogo.php?group_id=64430&amp;type=4"
width="125" height="37" alt="SourceForge.net Logo"></a></span></span>
</DIV>

<DIV class="mainBlock">
<H1>Teletext EPG grabber manual</H1>
<P>
This is the manual page for release 2.2 of the
<A HREF="http://nxtvepg.sourceforge.net/tv_grab_ttx">tv_grab_ttx</A> software package.</P>

<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#OPTIONS">OPTIONS</a></li>
  <li><a href="#GRABBING-PROCESS">GRABBING PROCESS</a></li>
  <li><a href="#FILES">FILES</a></li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#COPYRIGHT">COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>tv_grab_ttx - Grab TV listings from teletext through a TV card</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>tv_grab_ttx [options] [file-or-device]</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This EPG grabber allows to extract TV programme listings in XMLTV format from teletext pages as broadcast by most European TV networks. The grabber works by collecting teletext pages through a TV card, locating pages holding programme schedule tables and then scraping starting times, titles and attributes from those. Additionally, the grabber follows references to further teletext pages in the overviews to extract description texts. The grabber needs to be started separately for each TV channel from which EPG data shall be collected.</p>

<p>Teletext data is captured directly from <i>/dev/dvb/adapter0/demux0</i> or another device given as command line parameter. Alternatively, a file containing previously &quot;dumped&quot; VBI or raw teletext page data can be specified as input source. Use file name <code>-</code> to read from standard input (i.e. from a pipe)</p>

<p>The XMLTV output is written to standard out unless redirected to a file by use of the <i>-outfile</i> option. There are also &quot;dump&quot; options which allow to write each VBI packet or assembled teletext input pages in raw or clear text format. See <a href="#OPTIONS">&quot;OPTIONS&quot;</a> for details.</p>

<p>The EPG output generated by this grabber is compatible to all applications which can process XML files which adhere to XMLTV DTD version 0.5. See <a href="http://xmltv.org/">http://xmltv.org/</a> for a list of applications and a copy of the DTD specification. In particular, the output can be imported into <a href="http://man.he.net/man1/nxtvepg">nxtvepg(1)</a> and merged with <i>Nextview EPG</i>.</p>

<h1 id="OPTIONS">OPTIONS</h1>

<dl>

<dt id="dev-path"><b>-dev</b> <i>path</i></dt>
<dd>

<p>This option can be used to specify the device from which teletext is captured. By default <i>/dev/dvb/adapter0/demux0</i> is used. Note the device can also be specified in place of an input file (i.e. without preceding <code>-dev</code>, if it is the last word on the command line).</p>

</dd>
<dt id="dvbpid-PID"><b>-dvbpid</b> <i>PID</i></dt>
<dd>

<p>This option implies that the input device is Digital TV and specifies the PID of the data stream which contains teletext data. Note this parameter is <b>required for DVB devices</b>, else no data will be captured.</p>

<p>The teletext PID value can often be derived from the PID for video in <code>channels.conf</code> by adding offsets in range 3 to 30. Alternatively you can look up the PID via Internet services such as <a href="https://www.satindex.de/">https://www.satindex.de/</a>.</p>

</dd>
<dt id="duration-seconds"><b>-duration</b> <i>seconds</i></dt>
<dd>

<p>This option can be used to limit capturing from the VBI device to the given number of seconds. EPG grabbing will start afterwards.</p>

<p>If this option is not present, capturing stops automatically after reading approximately 4 complete page cycles. This option has no effect when reading VBI data from a file.</p>

</dd>
<dt id="page-NNN-MMM"><b>-page</b> NNN-MMM</dt>
<dd>

<p>This option specifies the range of the teletext page numbers in which the grabber searches for overview time tables. (Note the option does not limit the page range for description pages referenced by overviews.) The default page range is 301 to 399.</p>

</dd>
<dt id="outfile-path"><b>-outfile</b> path</dt>
<dd>

<p>This option can be used to redirect the XMLTV output into a file. By default the output is written to standard out.</p>

</dd>
<dt id="chn_name-name"><b>-chn_name</b> name</dt>
<dd>

<p>This option can be used to set the value of the <i>display-name</i> tag in the channel table of the generated XMLTV output. By default the name is extracted from teletext page headers.</p>

</dd>
<dt id="chn_id-id"><b>-chn_id</b> id</dt>
<dd>

<p>This option can be used to set the value of the channel <i>id</i> attribute in the channel table of the generated XMLTV output.</p>

<p>By default the identifier is derived from the canonical network identifier (CNI) which is broadcast as part of VPS and PDC. The grabber uses an internal table to map these numerical values to strings in the form suggested by RFC2838 (e.g. CNI <code>1DC1</code> is mapped to <code>ard.de</code>)</p>

</dd>
<dt id="merge-file"><b>-merge</b> file</dt>
<dd>

<p>This option can be used to merge the newly grabber data with previously grabbed data, or with data grabbed from other channels.</p>

<p><b>Caution:</b> This option only allows to merge input files which have been written by the same version of the grabber. This is because the grabber does not include a complete XMLTV parser, so the input is expected in the exact format in which the grabber has written it.</p>

</dd>
<dt id="expire-minutes"><b>-expire</b> minutes</dt>
<dd>

<p>This option can be used to omit programmes which have completed more than the given number of minutes ago. Note for programmes for which the stop time is unknown the start time plus 120 minutes is used. By default the expire time is 120 minutes.</p>

<p>This option is particularly intended for use together with the <i>-merge</i> option.</p>

</dd>
<dt id="dumpvbi"><b>-dumpvbi</b></dt>
<dd>

<p>This option can be used to omit almost all processing after digitization (&quot;slicing&quot;) of VBI data and write incoming teletext and VPS packets to the output. The output can later be read by the grabber as input file.</p>

<p>In the output, each data record consists of 46 bytes of which the first two contain the magazine and page number (0x000..0x7FF), the next three the header control bits including sub-page number, the next byte the packet number (0 for page header, 1..29 for teletext packets, 30 for PDC/NI packets, 32 for VPS) and finally the last 40 bytes the payload data (only 16-bit CNI value in case of VPS/PDC/NI) Note the byte-order of 16-bit values is platform-dependent.</p>

</dd>
<dt id="dumptext"><b>-dumptext</b></dt>
<dd>

<p>This option can be used to omit grabbing and instead print all teletext pages received in the input stream as text in Latin-1 encoding. Note control characters and characters which cannot be represented in Latin-1 are replaced with spaces. This option is intended for debugging purposes only.</p>

</dd>
<dt id="dumpraw-NNN-MMM"><b>-dumpraw</b> NNN-MMM</dt>
<dd>

<p>This option can be used to disable grabbing and instead write all teletext pages in the given page range to the output stream in a specific format which can later be imported again by specifying the file as input file on the command line.</p>

<p>The output includes the raw teletext packets for each page including all control characters. Additionally, the output contains the most a channel identification code and a timestamp which indicates the capture time. (Which are required to generate a channel name and parsing relative time and date specifications.)</p>

</dd>
<dt id="verify"><b>-verify</b></dt>
<dd>

<p>This option is only intended for use in verifying the teletext grabber functionality against previously captured reference input and output data. As such the option is not of interest for the general user.</p>

</dd>
<dt id="verbose"><b>-verbose</b></dt>
<dd>

<p>This option can be used for enabling output of the number of each received page while capturing teletext. This allows monitoring capture progress. Output is written to the <i>stderr</i> stream, so it will not corrupt XMLTV output when redirecting <i>stdout</i> into a file.</p>

</dd>
<dt id="pgstat"><b>-pgstat</b></dt>
<dd>

<p>This option can be used for enabling output of page reception statistics while capturing teletext. This allows monitoring capture progress. Output is written to the <i>stderr</i> stream, so it will not corrupt XMLTV output when redirecting <i>stdout</i> into a file.</p>

</dd>
<dt id="debug"><b>-debug</b></dt>
<dd>

<p>This option can be used to enable output of debugging information to standard output. You can use this to get additional diagnostic messages in case of trouble with the capture device. (Note most of these messages originate directly from the &quot;ZVBI&quot; library <i>libzvbi</i>.)</p>

<p>Additionally this option enables messages during parsing teletext pages; these are probably only helpful for developers. Note many of these messages go to <i>stdout</i> and thus will corrupt the generated XMLTV output when using redirection into a file.</p>

</dd>
<dt id="version"><b>-version</b></dt>
<dd>

<p>This option prints version and license information, then exits.</p>

</dd>
<dt id="help"><b>-help</b></dt>
<dd>

<p>This option prints the command line syntax, then exits.</p>

</dd>
</dl>

<p>After all options a file name can be specified. The file can either refer to a VBI device, or a file generated by <i>-dumpvbi</i> or <i>-dumpraw</i>. The parser automatically detects the type of the input file.</p>

<h1 id="GRABBING-PROCESS">GRABBING PROCESS</h1>

<p>This chapter describes the process in which EPG information is extracted from teletext pages. This information is not needed to use the grabber but may help you to understand the goals and limitations. The main challenge of the grabber is that source data is not formatted consistently. Formats used for tables, dates and other attributes may vary widely between networks and may also vary over time or even between pages in a cycle for a specific network. So far the grabber avoids any network-specific hacks and instead attempts to address the problem algorithmically.</p>

<p>Before starting the actual grabbing, all teletext packets are read from the input file or stream into memory and associated with teletext page numbers. In case the same packet is received more than once, the one with the lower parity error count is selected.</p>

<p>If a network is using sub-pages, the capturing duration has to be long enough to cover all cycles, else there may be gaps in the overview or description pages may be missing. Many networks however use sub-pages which only differ in advertisements; in this case a single cycle is enough. Currently the program does not detect this case automatically, hence the duration is usually configured as a constant, such as 90 seconds per channel.</p>

<p>The first step of grabbing is identification of the overview pages which contain tables with start times and programme titles. This is done by searching all pages for lines starting with a time value, but allowing for exceptions such as markers or hidden VPS labels:</p>

<pre><code>   20.00  Tagesschau UT ............ 310
 ! 20.15  Die Stein (10/13) UT ..... 324
          Zwischen Baum und Borke
          Fernsehserie, D 2008
 ! 21.05  In aller Freundschaft UT . 326
          Grossm tiges Herz (D, 2008)
 ! 21.50  Plusminus UT ............. 328</code></pre>

<p>Of course there may be unrelated rows which also start with a time value. Hence the grabber builds statistics about the number of occurrences of lines where the time and title start in the same column. In the end, the format found most often is selected as the one used for detecting time tables.</p>

<p>In the second step, the grabber revisits all pages and extracts start times and titles from all lines which are formatted in the way selected in step 1 above. Additionally, the title lines are broken apart into time, title, episode title, feature attributes (stereo, sub-titles etc.) and references to description pages are extracted. Afterwards stop times are calculated by asserting the start of subsequent programmes as the stop time of the previous one, unless a specific end time is given at the end of a page.</p>

<p>Finally the date is derived. In some cases the data is printed unambiguously on top of the page, but often the data is just given as &quot;Today&quot;, &quot;Tomorrow&quot; etc. or a weekday name. Even more difficult, a day on these pages sometimes is considered to span until apx. 6:00 on the next day, so finding &quot;today&quot; after midnight may actually mean &quot;yesterday&quot;. The latter is resolved by comparing dates between adjacent pages.</p>

<p>Format of dates is understood in many different formats. Examples:</p>

<pre><code>  Heute
  Sa 06-10
  29.04.06
  Sa 29.04.06
  Sa,29.04.
  Samstag, 29.April
  Sonnabend, 29.04.06
  29.04.2006</code></pre>

<p>In the third step, descriptions are grabbed from all pages which were referenced by the overview tables. Often, different sub-pages of the same page are used for descriptions belonging to different programmes. Hence the grabber must make a match between the referencing programmes start time and title and the content on the description page to identify the correct sub-page. Often this gets difficult when repetitions of an episode refer to the same description page (most often without listing only the original air date). Example:</p>

<pre><code>  Relic Hunter - Die Schatzj gerin
  Der magische Handschuh

  Sa 06.05 18:01-18:59           (vorbei)
  So 07.05 05:10-05:57           (vorbei)</code></pre>

<p>This step also attempts to improve the programme title by correlating the position of line-breaks between overview and description pages. Additional feature attributes may also be extracted here.</p>

<p>If a description page looks like a formatted table, the page is reformatted into a comma-separated list. This is done because white-space and line-breaks are not preserved by the grabber and most XMLTV browsers display the text with proportional fonts, so that the table columns would not be aligned in any case.</p>

<pre><code>  Darsteller:

  Jake Wade ............ Robert Taylor
  Clint Hollister ...... Richard Widmark</code></pre>

<p>The above will be converted into:</p>

<pre><code>  Darsteller:
  Jake Wade: Robert Taylor, Clint Hollister: Richard Widmark</code></pre>

<p>In the fourth step, the channel name and identifier are derived from teletext page headers and channel identification codes. Once more statistics are used to filter out transmission errors. Since the teletext page header usually contains additional text after the actual network name (e.g. &quot;ARDtext Sa 10.06.06&quot; instead of &quot;ARD&quot;) the name is derived by stripping all appendices which match known time/date formats or other common postfixes.</p>

<p>Finally, the data collected in all the above steps is optionally merged with an XMLTV file given by the &quot;-merge&quot; command line option. Then all the data is formatted in XMLTV format and printed to the output file.</p>

<h1 id="FILES">FILES</h1>

<dl>

<dt id="dev-vbi0"><b>/dev/vbi0</b></dt>
<dd>

<p>Device file from which teletext can be captured when using an analog TV card on Linux. Different paths can be selected with the <b>-dev</b> command line option. Depending on your Linux version, the device files may be located directly beneath <code>/dev</code> or inside <code>/dev/v4l</code>. Other operating systems such as BSD may use different names.</p>

</dd>
<dt id="dev-dvb-adapter0-demux0"><b>/dev/dvb/adapter0/demux0</b></dt>
<dd>

<p>Device file from which teletext can be captured when using a Digital TV device. Different paths can be selected with the <b>-dev</b> command line option. (If you have multiple TV cards, increment the device index after <i>adapter</i> to get the second card etc.)</p>

</dd>
</dl>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p><a href="http://man.he.net/man5/xmltv">xmltv(5)</a>, <a href="http://man.he.net/man1/tv_cat">tv_cat(1)</a>, <a href="http://man.he.net/man1/nxtvepg">nxtvepg(1)</a>, <a href="http://man.he.net/man1/v4lctl">v4lctl(1)</a>, <a href="http://man.he.net/man1/zvbid">zvbid(1)</a>, <a href="http://man.he.net/man1/alevt">alevt(1)</a>.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>The application was developed by T. Zoerner (tomzo at users.sourceforge.net) between 2006 and 2011 as part of the nxtvepg project (<a href="http://nxtvepg.sourceforge.net">http://nxtvepg.sourceforge.net</a>). The official homepage is <a href="https://github.com/tomzox/tv_grab_ttx">https://github.com/tomzox/tv_grab_ttx</a>.</p>

<p>The application was initially implemented in Perl, using the specially developed <i>Video::ZVBI</i> Perl extension module (<a href="https://metacpan.org/pod/Video::ZVBI">https://metacpan.org/pod/Video::ZVBI</a>) for capturing teletext. In 2010 it was translated to C++, heavily based on the <i>regex</i> regular expression library of the &quot;Boost&quot; project (<a href="https://www.boost.org/">https://www.boost.org/</a>). The latter was replaced in 2020 by <i>std::regex</i> which is part of C++ since release C++11.</p>

<p>The &quot;ZVBI&quot; library (<a href="http://zapping.sourceforge.net/ZVBI/index.html">http://zapping.sourceforge.net/ZVBI/index.html</a>) is used for capturing and decoding teletext.</p>

<h1 id="COPYRIGHT">COPYRIGHT</h1>

<p>Copyright 2006-2011, 2020 T. Zoerner.</p>

<p>This is free software. You may redistribute copies of it under the terms of the GNU General Public License version 3 or later <a href="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</a>. There is <b>no warranty</b>, to the extent permitted by law.</p>


</DIV>
</BODY>
</HTML>
